{% extends "base.html" %}
{% block content %}

<div class="container register mt-4">
    <!-- Header -->
    <div class="row mb-3">
        <div class="col text-end">
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">Logout</a>
            {% endif %}
        </div>
    </div>

    <h3 class="register-heading mb-3 text-center">Employee Dashboard</h3>

    <!-- Action Buttons -->
    <div class="mb-4 text-center">
        <a href="{{ url_for('employee.apply_leave') }}" class="btnRegister btn btn-primary me-2">Apply for Leave</a>
        <a href="{{ url_for('employee.history') }}" class="btnRegister btn btn-outline-secondary">My Leave History</a>
    </div>

    <!-- Recent Requests -->
    <h5 class="mt-4">Recent Requests</h5>
    {% if pending %}
    <div class="list-group mb-4 shadow-sm">
        {% for r in pending %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>{{ r.leave_type }}</strong> | {{ r.start_date }} â†’ {{ r.end_date }} ({{ r.duration() }} days)
                <div class="text-muted small">{{ r.reason }}</div>
            </div>
            <div class="text-end">
                <span class="badge 
                    {% if r.status == 'Pending' %}bg-warning
                    {% elif r.status == 'Approved' %}bg-success
                    {% elif r.status == 'Cancelled' %}bg-danger
                    {% else %}bg-secondary{% endif %}">
                    {{ r.status }}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-muted text-center">No recent requests.</p>
    {% endif %}

    <!-- All Leaves Table -->
    <h5 class="mt-4">My Leaves</h5>
    <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for leave in leaves %}
                <tr>
                    <td>{{ leave.id }}</td>
                    <td>{{ leave.leave_type }}</td>
                    <td>{{ leave.start_date }}</td>
                    <td>{{ leave.end_date }}</td>
                    <td>
                        <span class="badge 
                            {% if leave.status == 'Pending' %}bg-warning
                            {% elif leave.status == 'Approved' %}bg-success
                            {% elif leave.status == 'Cancelled' %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                            {{ leave.status }}
                        </span>
                    </td>
                    <td>
                        {% if leave.status == 'Pending' %}
                        <a href="{{ url_for('employee.edit_leave', leave_id=leave.id) }}" class="btn btn-sm btn-outline-primary me-1">Edit</a>
                        <a href="{{ url_for('employee.cancel_leave', leave_id=leave.id) }}" class="btn btn-sm btn-outline-danger">Cancel</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Optional Leave Form (if you want it on same page) -->
    {% if form %}
    <div class="register-right mt-5">
        <h5 class="register-heading">Apply for New Leave</h5>
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}
            <div class="row g-3">
                <div class="col-md-6">
                    {{ form.start_date.label(class="form-label") }}
                    {{ form.start_date(class="form-control") }}
                    {% for e in form.start_date.errors %}
                    <small class="text-danger">{{ e }}</small>
                    {% endfor %}
                </div>
                <div class="col-md-6">
                    {{ form.end_date.label(class="form-label") }}
                    {{ form.end_date(class="form-control") }}
                    {% for e in form.end_date.errors %}
                    <small class="text-danger">{{ e }}</small>
                    {% endfor %}
                </div>
                <div class="col-md-6">
                    {{ form.leave_type.label(class="form-label") }}
                    {{ form.leave_type(class="form-select") }}
                    {% for e in form.leave_type.errors %}
                    <small class="text-danger">{{ e }}</small>
                    {% endfor %}
                </div>
                <div class="col-md-12">
                    {{ form.reason.label(class="form-label") }}
                    {{ form.reason(class="form-control", rows=4) }}
                    {% for e in form.reason.errors %}
                    <small class="text-danger">{{ e }}</small>
                    {% endfor %}
                </div>
            </div>
            <div class="mt-3 d-flex justify-content-between">
                {{ form.submit(class="btnRegister btn btn-success") }}
                <a href="{{ url_for('employee.dashboard') }}" class="btnBack btn btn-outline-secondary">Cancel</a>
            </div>
        </form>
    </div>
    {% endif %}

</div>

<style>
.register {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #fff;
    padding: 3%;
}
.register-heading {
    text-align: center;
    margin-bottom: 20px;
    color: #ffffffff;
}
.btnRegister {
    border-radius: 1.5rem;
    padding: 8px 20px;
    background: #2c5364;
    color: #fff;
    font-weight: 600;
}
.btnRegister:hover {
    background: #0F2027;
    color: #fff;
}
.btnBack {
    border-radius: 1.5rem;
    padding: 8px 20px;
    border: 2px solid #2c5364;
    background: transparent;
    color: #2c5364;
    text-decoration: none;
}
.btnBack:hover {
    background: #2c5364;
    color: #fff;
}
.table-responsive {
    background: #fff;
    border-radius: 12px;
    padding: 10px;
}
.text-muted {
    color: white;
}
</style>

{% endblock %}